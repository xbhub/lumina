"use strict";layui.define(["laytpl","form"],function(e){function n(){var a=this,e=a.config,t=e.id||a.index;return n.that[t]=a,{config:n.config[t]=e,reload:function(e){a.reload.call(a,e)},getData:function(){return a.getData.call(a)}}}function a(e){return['<div class="layui-transfer-box" data-index="'+(e=e||{}).index+'">','<div class="layui-transfer-header">','<input type="checkbox" name="'+e.checkAllName+'" lay-filter="layTransferCheckbox" lay-type="all" lay-skin="primary" title="{{ d.data.title['+e.index+"] || 'list"+(e.index+1)+"' }}\">","</div>","{{# if(d.data.showSearch){ }}",'<div class="layui-transfer-search">','<i class="layui-icon layui-icon-search"></i>','<input type="input" class="layui-input" placeholder="关键词搜索">',"</div>","{{# } }}",'<ul class="layui-transfer-data"></ul>',"</div>"].join("")}function t(e){var a=this;a.index=++c.index,a.config=s.extend({},a.config,c.config,e),a.render()}var s=layui.$,i=layui.laytpl,r=layui.form,l="transfer",c={config:{},index:layui[l]?layui[l].index+1e4:0,set:function(e){var a=this;return a.config=s.extend({},a.config,e),a},on:function(e,a){return layui.onevent.call(this,l,e,a)}},d="layui-hide",h="layui-btn-disabled",o="layui-none",u="layui-transfer-box",f="layui-transfer-header",y="layui-transfer-search",p="layui-transfer-data",v=['<div class="layui-transfer layui-form layui-border-box" lay-filter="LAY-transfer-{{ d.index }}">',a({index:0,checkAllName:"layTransferLeftCheckAll"}),'<div class="layui-transfer-active">','<button type="button" class="layui-btn layui-btn-sm layui-btn-primary layui-btn-disabled" data-index="0">','<i class="fa fa-arrow-right"></i>',"</button>",'<button type="button" class="layui-btn layui-btn-sm layui-btn-primary layui-btn-disabled" data-index="1">','<i class="fa fa-arrow-left"></i>',"</button>","</div>",a({index:1,checkAllName:"layTransferRightCheckAll"}),"</div>"].join("");t.prototype.config={title:["列表一","列表二"],searchKey:"",width:200,height:360,data:[],value:[],showSearch:!1,id:"",text:{none:"无数据",searchNone:"无匹配数据"}},t.prototype.reload=function(e){var t=this;layui.each(e,function(e,a){a.constructor===Array&&delete t.config[e]}),t.config=s.extend(!0,{},t.config,e),t.render()},t.prototype.render=function(){var e=this,a=e.config,t=e.elem=s(i(v).render({data:a,index:e.index})),n=a.elem=s(a.elem);n[0]&&(a.data=a.data||[],a.value=a.value||[],e.key=a.id||e.index,n.html(e.elem),e.layBox=e.elem.find("."+u),e.layHeader=e.elem.find("."+f),e.laySearch=e.elem.find("."+y),e.layData=t.find("."+p),e.layBtn=t.find(".layui-transfer-active .layui-btn"),e.layBox.css({width:a.width,height:a.height}),e.layData.css({height:a.height-e.layHeader.outerHeight()-e.laySearch.outerHeight()-2}),e.renderData(),e.events())},t.prototype.renderData=function(){var e=this,n=(e.config,[{checkName:"layTransferLeftCheck",views:[]},{checkName:"layTransferRightCheck",views:[]}]);e.parseData(function(e){var a=e.selected?1:0,t=["<li>",'<input type="checkbox" name="'+n[a].checkName+'" lay-skin="primary" lay-filter="layTransferCheckbox" title="'+e.title+'"'+(e.disabled?" disabled":"")+(e.checked?" checked":"")+' value="'+e.value+'">',"</li>"].join("");n[a].views.push(t),delete e.selected}),e.layData.eq(0).html(n[0].views.join("")),e.layData.eq(1).html(n[1].views.join("")),e.renderCheckBtn()},t.prototype.renderForm=function(e){r.render(e,"LAY-transfer-"+this.index)},t.prototype.renderCheckBtn=function(l){var c=this,o=c.config;l=l||{},c.layBox.each(function(e){var a=s(this),t=a.find("."+p),n=a.find("."+f).find('input[type="checkbox"]'),a=t.find('input[type="checkbox"]'),i=0,r=!1;a.each(function(){var e=s(this).data("hide");(this.checked||this.disabled||e)&&i++,this.checked&&!e&&(r=!0)}),n.prop("checked",r&&i===a.length),c.layBtn.eq(e)[r?"removeClass":"addClass"](h),l.stopNone||(e=t.children("li:not(."+d+")").length,c.noneView(t,e?"":o.text.none))}),c.renderForm("checkbox")},t.prototype.noneView=function(e,a){var t=s('<p class="layui-none">'+(a||"")+"</p>");e.find("."+o)[0]&&e.find("."+o).remove(),a.replace(/\s/g,"")&&e.append(t)},t.prototype.setValue=function(){var e=this.config,a=[];return this.layBox.eq(1).find("."+p+' input[type="checkbox"]').each(function(){s(this).data("hide")||a.push(this.value)}),e.value=a,this},t.prototype.parseData=function(a){var n=this.config,i=[];return layui.each(n.data,function(e,t){t=("function"==typeof n.parseData?n.parseData(t):t)||t,i.push(t=s.extend({},t)),layui.each(n.value,function(e,a){a==t.value&&(t.selected=!0)}),a&&a(t)}),n.data=i,this},t.prototype.getData=function(e){var a=this.config,n=[];return layui.each(e||a.value,function(e,t){layui.each(a.data,function(e,a){delete a.selected,t==a.value&&n.push(a)})}),n},t.prototype.events=function(){var r=this,l=r.config;r.elem.on("click",'input[lay-filter="layTransferCheckbox"]+',function(){var e=s(this).prev(),a=e[0].checked,t=e.parents("."+u).eq(0).find("."+p);e[0].disabled||("all"===e.attr("lay-type")&&t.find('input[type="checkbox"]').each(function(){this.disabled||(this.checked=a)}),r.renderCheckBtn({stopNone:!0}))}),r.layBtn.on("click",function(){var e=s(this),a=e.data("index"),n=r.layBox.eq(a),i=[];e.hasClass(h)||(r.layBox.eq(a).each(function(e){s(this).find("."+p).children("li").each(function(){var e=s(this),a=e.find('input[type="checkbox"]'),t=a.data("hide");a[0].checked&&!t&&(a[0].checked=!1,n.siblings("."+u).find("."+p).append(e.clone()),e.remove(),i.push(a[0].value)),r.setValue()})}),r.renderCheckBtn(),""===(e=n.siblings("."+u).find("."+y+" input")).val()||e.trigger("keyup"),l.onchange&&l.onchange(r.getData(i),a))}),r.laySearch.find("input").on("keyup",function(){var e=s(this),n=this.value,a=s(this).parents("."+y).eq(0).siblings("."+p),t=a.children("li");0==e.parents(".layui-transfer-box").data("index")&&-1<l.showSearch.indexOf("http")?setTimeout(function(){s.ajax({url:l.showSearch,headers:{"X-CSRF-TOKEN":s('meta[name="csrf-token"]').attr("content"),Accept:"application/json","X-Requested-With":"XMLHttpRequest"},data:{key:n},dataType:"json",success:function(e){r.reload({data:e.data,searchKey:n})}})},500):(t.each(function(){var e=s(this),a=e.find('input[type="checkbox"]'),t=-1!==a[0].title.indexOf(n);e[t?"removeClass":"addClass"](d),a.data("hide",!t)}),t=t.length===a.children("li."+d).length,r.noneView(a,t?l.text.searchNone:"")),r.renderCheckBtn()})},n.that={},n.config={},c.reload=function(e,a){e=n.that[e];return e.reload(a),n.call(e)},c.getData=function(e){return n.that[e].getData()},c.render=function(e){e=new t(e);return n.call(e)},e(l,c)});