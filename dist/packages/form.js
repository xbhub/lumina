"use strict";layui.extend({upload:"extends/upload/upload"}).define(["laydate","upload","util","admin"],function(e){var k=layui.$,r=layui.laydate,d=layui.upload,f=layui.layer,h=(layui.util,layui.admin),t=layui.hint(),v=layui.device(),b="form",p=".layui-form",C="layui-this",w="layui-hide",I="layui-disabled",a=function(){this.config={verify:{required:[/[\S]+/,"必填项不能为空"],phone:[/^1\d{10}$/,"请输入正确的手机号"],email:[/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,"邮箱格式不正确"],url:[/(^#)|(^http(s*):\/\/[^\s]+\.[^\s]+)/,"链接格式不正确"],number:function(e){if(!e||isNaN(e))return"只能填写数字"},date:[/^(\d{4})[-\/](\d{1}|0\d{1}|1[0-2])([-\/](\d{1}|0\d{1}|[1-2][0-9]|3[0-1]))*$/,"日期格式不正确"],identity:[/(^\d{15}$)|(^\d{17}(x|X|\d)$)/,"请输入正确的身份证号"]}}};a.prototype.set=function(e){return k.extend(!0,this.config,e),this},a.prototype.verify=function(e){return k.extend(!0,this.config.verify,e),this},a.prototype.on=function(e,a){return layui.onevent.call(this,b,e,a)},a.prototype.val=function(e,i){k(p+'[lay-filter="'+e+'"]').each(function(e,a){var t=k(this);layui.each(i,function(e,a){var i=t.find('[name="'+e+'"]');i[0]&&("checkbox"===(e=i[0].type)?i[0].checked=a:"radio"===e?i.each(function(){this.value===a&&(this.checked=!0)}):i.val(a))})}),y.render(null,e)},a.prototype.render=function(e,c){var o=this,i=k(p+(c?'[lay-filter="'+c+'"]':"")),a={select:function(){function v(e,a){k(e.target).parent().hasClass(m)&&!a||(k("."+y).removeClass(y+"ed "+y+"up"),p&&x&&p.val(x)),p=null}function s(t,e,a){var d,i,n,o,l,r=k(this),s=t.find("."+m),c=s.find("input"),u=t.find("dl"),f=u.children("dd"),h=this.selectedIndex;e||(i=function(){var e=t.offset().top+t.outerHeight()+5-L.scrollTop(),a=u.outerHeight();h=r[0].selectedIndex,t.addClass(y+"ed"),f.removeClass(w),d=null,f.eq(h).addClass(C).siblings().removeClass(C),e+a>L.height()&&a<=e&&t.addClass(y+"up"),o()},n=function(e){t.removeClass(y+"ed "+y+"up"),c.blur(),d=null,e||l(c.val(),function(e){var a=r[0].selectedIndex;e&&(x=k(r[0].options[a]).html(),0===a&&x===c.attr("placeholder")&&(x=""),c.val(x||""))})},o=function(){var e,a,i=u.children("dd."+C);i[0]&&(e=i.position().top,a=u.height(),i=i.height(),a<e&&u.scrollTop(e+u.scrollTop()-a+i-5),e<0&&u.scrollTop(e+u.scrollTop()-5))},s.on("click",function(e){t.hasClass(y+"ed")?n():(v(e,!0),i()),u.find("."+g).remove()}),s.find(".layui-edge").on("click",function(){c.focus()}),c.on("keyup",function(e){9===e.keyCode&&i()}).on("keydown",function(l){var e=l.keyCode;9===e&&n();function r(t,n){l.preventDefault();var e=function(){var e=u.children("dd."+C);if(u.children("dd."+w)[0]&&"next"===t){var a=u.children("dd:not(."+w+",."+I+")"),i=a.eq(0).index();if(0<=i&&i<e.index()&&!a.hasClass(C))return a.eq(0).prev()[0]?a.eq(0).prev():u.children(":last")}return n&&n[0]?n:d&&d[0]?d:e}(),a=e[t](),i=e[t]("dd:not(."+w+")");return a[0]?(d=e[t](),i[0]&&!i.hasClass(I)||!d[0]?(i.addClass(C).siblings().removeClass(C),void o()):r(t,d)):d=null}38===e&&r("prev"),40===e&&r("next"),13===e&&(l.preventDefault(),u.children("dd."+C).trigger("click"))}),l=function(t,e,n){var l=0;layui.each(f,function(){var e=k(this),a=e.text(),i=-1===a.indexOf(t);(""===t||"blur"===n?t!==a:i)&&l++,"keyup"===n&&e[i?"addClass":"removeClass"](w)});var a=l===f.length;return e(a),a},a&&c.on("keyup",function(e){var a=this.value,e=e.keyCode;if(9===e||13===e||37===e||38===e||39===e||40===e)return!1;l(a,function(e){e?u.find("."+g)[0]||u.append('<p class="'+g+'">无匹配项</p>'):u.find("."+g).remove()},"keyup"),""===a&&u.find("."+g).remove(),o()}).on("blur",function(e){var a=r[0].selectedIndex;p=c,x=k(r[0].options[a]).html(),0===a&&x===c.attr("placeholder")&&(x=""),setTimeout(function(){l(c.val(),function(e){x||c.val("")},"blur")},200)}),f.on("click",function(){var e=k(this),a=e.attr("lay-value"),i=r.attr("lay-filter");return e.hasClass(I)||(e.hasClass("layui-select-tips")?c.val(""):(c.val(e.text()),e.addClass(C)),e.siblings().removeClass(C),r.val(a).removeClass("layui-form-danger"),layui.event.call(this,b,"select("+i+")",{elem:r[0],value:a,othis:t}),n(!0)),!1}),t.find("dl>dt").on("click",function(e){return!1}),k(document).off("click",v).on("click",v))}var p,c="请选择",y="layui-form-select",m="layui-select-title",g="layui-select-none",x="",e=i.find("select");e.each(function(e,a){var i=k(this),t=i.next("."+y),n=this.disabled,l=a.value,r=k(a.options[a.selectedIndex]),d=a.options[0];if("string"==typeof i.attr("lay-ignore"))return i.show();var o,a="string"==typeof i.attr("lay-search"),d=d&&!d.value&&d.innerHTML||c,r=k(['<div class="'+(a?"":"layui-unselect ")+y,(n?" layui-select-disabled":"")+'">','<div class="'+m+'">','<input type="text" placeholder="'+d+'" value="'+(l?r.html():"")+'"'+(a?"":" readonly")+' class="layui-input'+(a?"":" layui-unselect")+(n?" "+I:"")+'">','<i class="layui-edge"></i></div>','<dl class="fa'+(i.find("optgroup")[0]?" layui-select-group":"")+'">',(r=i.find("*"),o=[],layui.each(r,function(e,a){0!==e||a.value?"optgroup"===a.tagName.toLowerCase()?o.push("<dt>"+a.label+"</dt>"):o.push('<dd lay-value="'+a.value+'" class="'+(l===a.value?C:"")+(a.disabled?" "+I:"")+'">'+a.innerHTML+"</dd>"):o.push('<dd lay-value="" class="layui-select-tips">'+(a.innerHTML||c)+"</dd>")}),0===o.length&&o.push('<dd lay-value="" class="'+I+'">没有选项</dd>'),o.join("")+"</dl>"),"</div>"].join(""));t[0]&&t.remove(),i.after(r),s.call(this,r,n,a)})},checkbox:function(){var o={checkbox:["layui-form-checkbox","layui-form-checked","checkbox"],_switch:["layui-form-switch","layui-form-onswitch","switch"]},e=i.find("input[type=checkbox]");e.each(function(e,a){var i=k(this),t=i.attr("lay-skin"),n=(i.attr("lay-text")||"").split("|"),l=this.disabled,r=o[t="switch"===t?"_"+t:t]||o.checkbox;if("string"==typeof i.attr("lay-ignore"))return i.show();var d=i.next("."+r[0]),n=k(['<div class="layui-unselect '+r[0],a.checked?" "+r[1]:"",l?" layui-checkbox-disbaled "+I:"",'"',t?' lay-skin="'+t+'"':"",">",(n={checkbox:[a.title.replace(/\s/g,"")?"<span>"+a.title+"</span>":"",'<i class="fa fa-check"></i>'].join(""),_switch:"<em>"+((a.checked?n[0]:n[1])||"")+"</em><i></i>"})[t]||n.checkbox,"</div>"].join(""));d[0]&&d.remove(),i.after(n),function(i,t){var n=k(this);i.on("click",function(){var e=n.attr("lay-filter"),a=(n.attr("lay-text")||"").split("|");n[0].disabled||(n[0].checked?(n[0].checked=!1,i.removeClass(t[1]).find("em").text(a[1])):(n[0].checked=!0,i.addClass(t[1]).find("em").text(a[0])),layui.event.call(n[0],b,t[2]+"("+e+")",{elem:n[0],value:n[0].value,othis:i}))})}.call(this,n,r)})},radio:function(){var d="layui-form-radio",e=i.find("input[type=radio]");e.each(function(e,a){var i=k(this),t=i.next("."+d),n=this.disabled;if("string"==typeof i.attr("lay-ignore"))return i.show();t[0]&&t.remove();a=k(['<div class="layui-unselect '+d,a.checked?" "+d+"ed":"",(n?" layui-radio-disbaled "+I:"")+'">','<i class="fa '+(a.checked?"fa-dot-circle-o":"fa-circle-o")+'"></i>',"<div>"+(a=a.title||"","string"==typeof i.next().attr("lay-radio")&&(a=i.next().html(),i.next().remove()),a)+"</div>","</div>"].join(""));i.after(a),function(t){var n=k(this),l="fa-circle-o",r="fa-dot-circle-o";t.on("click",function(){var e=n[0].name,a=n.parents(p),i=n.attr("lay-filter"),e=a.find("input[name="+e.replace(/(\.|#|\[|\])/g,"\\$1")+"]");n[0].disabled||(layui.each(e,function(){var e=k(this).next("."+d);this.checked=!1,e.removeClass(d+"ed"),e.find(".fa").removeClass(r).addClass(l)}),n[0].checked=!0,t.addClass(d+"ed"),t.find(".fa").addClass(r).removeClass(l),layui.event.call(n[0],b,"radio("+i+")",{elem:n[0],value:n[0].value,othis:t}))})}.call(this,a)})},img:function(){function l(e,a){var i=a.parents("."+o),t=a.find(".uploader__files"),n=a.find(".img__picker"),l=i.find("input[type=hidden]"),r=n.data("limit");if(c=i.attr("lay-filter"),1==r&&void 0!==e[0]&&0<e[0].length)t.append(s.replace(new RegExp(/(UPLOADEDFILE)/g),e[0])),l.val(e[0]),n.hide();else{var d=l.val();if((d=void 0!==d&&1<d.length?d.split(","):[]).length>=r)return;k.each(e,function(e,a){d.push(a),d.length>=r&&n.hide(),t.append(s.replace(new RegExp(/(UPLOADEDFILE)/g),a))}),l.val(d.join(","))}t.on("mouseenter",".uploader__file",function(){k(this).find(".uploader__mask").show()}).on("mouseleave",".uploader__file",function(){k(this).find(".uploader__mask").hide()}),t.on("click",".j_delete",function(){var e,a;1==r?(t.remove(),n.show(),l.val("")):(k(this).parents(".uploader__file").remove(),a=k(this).attr("data-id"),-1<(a=(e=1<(e=l.val()).length?e.split(","):[]).indexOf(a))&&e.splice(a,1),n.show(),l.val(e))}),layui.event.call(e[0],b,"img("+c+")",{elem:e[0],value:l.val(),othis:a})}var o="layui-form-img",e=i.find("."+o),s='<li class="uploader__file" style="background-image: url(UPLOADEDFILE)"><div class="uploader__mask" style="display: none"><div class="mask__delete"><a href="javascript:;" class="j_delete" data-id="UPLOADEDFILE"><i class="fa fa-close"></i></a></div></div></li>';e.each(function(e,a){var i=k(this),t=i.find("input[type=hidden]").val(),n=i.data("limit")||1,n=k(['<div class="m-uploader clearfix">','<ul class="uploader__files"></ul>','<div class="img__picker" data-limit="'+n+'" ></div>',"</div>"].join(""));0<i.find(".m-uploader").length||(i.append(n),l(void 0!==t&&0<t.length?t.split(","):[],n),function(a){var e=k(this),i=a.find(".img__picker"),t=e.data("limit");i.on("click",function(){d.render({url:"/api/upload",fileNumLimit:t,done:function(e){l(e,a)}})})}.call(this,n))})},date:function(){i.find(".layui-form-date").each(function(e,a){r.render({elem:a,type:k(a).attr("date-type")||"date"})}),i.find(".layui-form-daterange").each(function(e,a){var i=k(this),t="",n="",l=i.data("options"),t=r.render({elem:i.find(".start_at")[0],min:l.min||"1900-1-1",max:l.max||"2999-12-31",type:l.type||"date",value:i.find(".start_at")[0].value,done:function(e,a){n.config.min=lay.extend({},a,{month:a.month-1})}}),n=r.render({elem:i.find(".end_at")[0],min:l.min||"1900-1-1",max:l.max||"2999-12-31",type:l.type||"date",value:i.find(".end_at")[0].value,done:function(e,a){t.config.max=lay.extend({},a,{month:a.month-1})}})})},region:function(){var a="layui-region",r=function(i,e){var t=i.data("id"),n=i.parents("."+a).data("mode")||"id",l=!1;k.each(e,function(e,a){!1===l&&!1===l&&(l=0<t&&t===a.id);a='<option value="'+("id"==n?a.id:a.label)+'">'+a.label+"</option>";i.append(a)}),l&&i.val(t),o.render("select")},d=function(e){e.find("option").remove()};i.find("."+a).each(function(e,a){var i=k(a),t=k.parseJSON(i.find("input[name=_data]").val()),a=i.find("[data-province]"),n=i.find("[data-city]"),l=i.find("[data-region]");o.on("select(province)",function(e){var a=Number(e.value),e=[{id:"",label:""}];0<a&&(d(n),d(l),n.data("provinceId",a),e=e.concat(_.find(t,{id:a}).children),r(n,e),n.parent("div").show(),l.parent("div").hide())}),o.on("select(city)",function(e){k(this);var a=n.data("provinceId"),e=Number(e.value);0<e&&(d(l),l.data("cityId",e),a=_.find(t,{id:a}).children,r(l,_.find(a,{id:e}).children),l.parent("div").show())}),r(a,t)})}};return e?a[e]?a[e]():t.error("不支持的"+e+"表单渲染"):layui.each(a,function(e,a){a()}),o};function i(){var e=k(this),o=y.config.verify,s=null,c="layui-form-danger",t={},a=(r=e.parents(p)).find("*[lay-verify]"),i=e.parents("form")[0],n=r.find("input,select,textarea"),l=e.attr("lay-filter"),r=e.hasClass("J_ajax");if(layui.each(a,function(e,n){var l=k(this),a=l.attr("lay-verify").split("|"),r=l.attr("lay-verType"),d=l.val();if(l.removeClass(c),layui.each(a,function(e,a){var i="",t="function"==typeof o[a];if(o[a]){t=t?i=o[a](d,n):!o[a][0].test(d),i=i||o[a][1];if(t)return"tips"===r?f.tips(i,"string"==typeof l.attr("lay-ignore")||"select"!==n.tagName.toLowerCase()&&!/^checkbox|radio$/.test(n.type)?l:l.next(),{tips:1}):"alert"===r?f.alert(i,{title:"提示",shadeClose:!0}):f.msg(i,{icon:5,shift:6}),v.android||v.ios||n.focus(),l.addClass(c),s=!0}}),s)return s}),s)return!1;var d={};layui.each(n,function(e,a){var i;a.name=(a.name||"").replace(/^\s*|\s*&/,""),a.name&&(/^.*\[\]$/.test(a.name)&&(i=a.name.match(/^(.*)\[\]$/g)[0],d[i]=0|d[i],a.name=a.name.replace(/^(.*)\[\]$/,"$1["+d[i]+++"]")),/^checkbox|radio$/.test(a.type)&&!a.checked||(t[a.name]=a.value))});var u=e.parents("form");return r?(layui.util.request.ajax({type:u.attr("method"),url:u.attr("action"),data:t,success:function(e){if(0==e.errcode){if(f.msg(e.msg),e.data.hasOwnProperty("redirect"))return void setTimeout(function(){h.openTab(e.data.redirect,"列表")},1500);parent.layer&&window.name&&setTimeout(function(){parent.layer.close(parent.layer.getFrameIndex(window.name))},1500),u[0].reset()}else f.alert(e.msg,{title:"提示",shadeClose:!0});return layui.event.call(this,b,"submit("+l+")",{elem:this,form:i,field:t})}}),!1):layui.event.call(this,b,"submit("+l+")",{elem:this,form:i,field:t})}var y=new a,a=k("body"),L=k(window);y.render(),a.on("reset",p,function(){var e=k(this).attr("lay-filter");setTimeout(function(){y.render(null,e)},50)}),a.on("submit",p,i).on("click","*[lay-submit]",i),a.on("click","*[lay-submit-cancel]",function(){parent.layer.close(parent.layer.getFrameIndex(window.name))}),e(b,y)});