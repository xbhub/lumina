"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}layui.define("form",function(e){function n(){var i=this,e=i.config,a=e.id||i.index;return n.that[a]=i,{config:n.config[a]=e,reload:function(e){i.reload.call(i,e)},getChecked:function(){return i.getChecked.call(i)},setChecked:function(e){return i.setChecked.call(i,e)}}}function i(e){var i=this;i.index=++r.index,i.config=k.extend({},i.config,r.config,e),i.render()}var k=layui.$,a=layui.form,t="tree",r={config:{},index:layui[t]?layui[t].index+1e4:0,set:function(e){var i=this;return i.config=k.extend({},i.config,e),i},on:function(e,i){return layui.onevent.call(this,t,e,i)}},g="layui-hide",d="layui-disabled",x="layui-tree-set",b="layui-tree-iconClick",w="fa-plus-square-o",T="fa-minus-square-o",L="layui-tree-entry",p="layui-tree-main",y="layui-tree-txt",q="layui-tree-pack",N="layui-tree-spread",S="layui-tree-setLineShort",A="layui-tree-showLine",F="layui-tree-lineExtend";i.prototype.config={data:[],showCheckbox:!1,showLine:!0,accordion:!1,onlyIconControl:!1,isJump:!1,edit:!1,text:{defaultNodeName:"未命名",none:"无数据"}},i.prototype.reload=function(e){var a=this;layui.each(e,function(e,i){i.constructor===Array&&delete a.config[e]}),a.config=k.extend(!0,{},a.config,e),a.render()},i.prototype.render=function(){var e=this,i=e.config,a=k('<div class="layui-tree'+(i.showCheckbox?" layui-form":"")+(i.showLine?" layui-tree-line":"")+'" lay-filter="LAY-tree-'+e.index+'"></div>');e.tree(a);var n=i.elem=k(i.elem);if(n[0]){if(i.showSearch&&a.prepend('<input type="text" class="layui-input layui-tree-search" placeholder="请输入关键字进行过滤">'),e.key=i.id||e.index,e.elem=a,e.elemNone=k('<div class="layui-tree-emptyText">'+i.text.none+"</div>"),n.html(e.elem),0==e.elem.find(".layui-tree-set").length)return e.elem.append(e.elemNone);i.drag&&e.drag(),i.showCheckbox&&e.renderForm("checkbox"),e.elem.find(".layui-tree-set").each(function(){var e=k(this);e.parent(".layui-tree-pack")[0]||e.addClass("layui-tree-setHide"),!e.next()[0]&&e.parents(".layui-tree-pack").eq(1).hasClass("layui-tree-lineExtend")&&e.addClass(S),e.next()[0]||e.parents(".layui-tree-set").eq(0).next()[0]||e.addClass(S)}),e.events()}},i.prototype.renderForm=function(e){a.render(e,"LAY-tree-"+this.index)},i.prototype.tree=function(r,e){var l=this,s=l.config,e=e||s.data;layui.each(e,function(e,i){var a=i.children&&0<i.children.length,n=k('<div class="layui-tree-pack" '+(i.spread?'style="display: block;"':"")+'"></div>'),t=k(['<div data-id="'+i.id+'" class="layui-tree-set'+(i.spread?" layui-tree-spread":"")+(i.checked?" layui-tree-checkedFirst":"")+'">',"<div "+(s.drag&&!i.fixed?'draggable="true"':"")+' class="layui-tree-entry">','<div class="layui-tree-main">',s.showLine?a?'<span class="layui-tree-iconClick layui-tree-icon"><i class="fa '+(i.spread?"fa-minus-square-o":"fa-plus-square-o")+'"></i></span>':'<span class="layui-tree-iconClick"><i class="fa fa-file"></i></span>':'<span class="layui-tree-iconClick"><i class="layui-tree-iconArrow '+(a?"":g)+'"></i></span>',s.showCheckbox?'<input type="checkbox" name="layuiTreeCheck" lay-skin="primary" '+(i.disabled?"disabled":"")+'  value="'+i.id+'">':"",s.isJump&&i.href?'<a href="'+i.href+'" target="_blank" class="'+y+'">'+(i.text||i.label||s.text.defaultNodeName)+"</a>":'<span class="'+y+(i.disabled?" "+d:"")+'">'+(i.text||i.label||s.text.defaultNodeName)+"</span>","</div>",function(){if(!s.edit)return"";var a={add:'<i class="fa fa-add-1"  data-type="add"></i>',update:'<i class="fa fa-edit" data-type="update"></i>',del:'<i class="fa fa-delete" data-type="del"></i>'},n=['<div class="layui-btn-group layui-tree-btnGroup">'];return!0===s.edit&&(s.edit=["update","del"]),"object"===_typeof(s.edit)?(layui.each(s.edit,function(e,i){n.push(a[i]||"")}),n.join("")+"</div>"):void 0}(),"</div></div>"].join(""));a&&(t.append(n),l.tree(n,i.children)),r.append(t),t.prev("."+x)[0]&&t.prev().children(".layui-tree-pack").addClass("layui-tree-showLine"),a||t.parent(".layui-tree-pack").addClass("layui-tree-lineExtend"),l.spread(t,i),s.showCheckbox&&l.checkClick(t,i),s.edit&&l.operate(t,i)})},i.prototype.spread=function(n,e){var t=this.config,i=n.children("."+L),a=i.children("."+p),r=i.find("."+b),i=i.find("."+y),l=t.onlyIconControl?r:a,s="";l.on("click",function(e){var i=n.children("."+q),a=(l.children(".fa")[0]?l:l.find(".layui-tree-icon")).children(".fa");i[0]?n.hasClass(N)?(n.removeClass(N),i.slideUp(200),a.removeClass(T).addClass(w)):(n.addClass(N),i.slideDown(200),a.addClass(T).removeClass(w),t.accordion&&((a=n.siblings("."+x)).removeClass(N),a.children("."+q).slideUp(200),a.find(".layui-tree-icon").children(".fa").removeClass(T).addClass(w))):s="normal"}),i.on("click",function(){k(this).hasClass(d)||(s=n.hasClass(N)?t.onlyIconControl?"open":"close":t.onlyIconControl?"close":"open",t.click&&t.click({elem:n,state:s,data:e}))})},i.prototype.setCheckbox=function(e,i,a){this.config;var r=a.prop("checked");"object"!==_typeof(i.children)&&!e.find("."+q)[0]||e.find("."+q).find('input[name="layuiTreeCheck"]').each(function(){this.disabled||(this.checked=r)}),function e(i){var a,n,t;i.parents("."+x)[0]&&(t=(n=i.parent("."+q)).parent(),i=n.prev().find('input[name="layuiTreeCheck"]'),r?i.prop("checked",r):(n.find('input[name="layuiTreeCheck"]').each(function(){this.checked&&(a=!0)}),a||i.prop("checked",!1)),e(t))}(e),this.renderForm("checkbox")},i.prototype.checkClick=function(a,n){var t=this,r=t.config;a.children("."+L).children("."+p).on("click",'input[name="layuiTreeCheck"]+',function(e){layui.stope(e);var i=k(this).prev(),e=i.prop("checked");i.prop("disabled")||(t.setCheckbox(a,n,i),r.oncheck&&r.oncheck({elem:a,checked:e,data:n}))})},i.prototype.operate=function(c,o){var h=this,u=h.config,e=c.children("."+L),f=e.children("."+p);e.children(".layui-tree-btnGroup").on("click",".fa",function(e){layui.stope(e);var i=k(this).data("type"),a=c.children("."+q),n={data:o,type:i,elem:c};if("add"==i){a[0]||(u.showLine?(f.find("."+b).addClass("layui-tree-icon"),f.find("."+b).children(".fa").addClass(w).removeClass("fa-file")):f.find(".layui-tree-iconArrow").removeClass(g),c.append('<div class="layui-tree-pack"></div>'));var t,r,l,s=u.operate&&u.operate(n),e={};if(e.text=u.text.defaultNodeName,e.id=s,h.tree(c.children("."+q),[e]),u.showLine&&(a[0]?(a.hasClass(F)||a.addClass(F),c.find("."+q).each(function(){k(this).children("."+x).last().addClass(S)}),(a.children("."+x).last().prev().hasClass(S)?a.children("."+x).last().prev():a.children("."+x).last()).removeClass(S),!c.parent("."+q)[0]&&c.next()[0]&&a.children("."+x).last().removeClass(S)):(t=c.siblings("."+x),r=1,l=c.parent("."+q),layui.each(t,function(e,i){k(i).children("."+q)[0]||(r=0)}),1==r?(t.children("."+q).addClass(A),t.children("."+q).children("."+x).removeClass(S),c.children("."+q).addClass(A),l.removeClass(F),l.children("."+x).last().children("."+q).children("."+x).last().addClass(S)):c.children("."+q).children("."+x).addClass(S))),!u.showCheckbox)return;f.find('input[name="layuiTreeCheck"]')[0].checked&&(c.children("."+q).children("."+x).last().find('input[name="layuiTreeCheck"]')[0].checked=!0),h.renderForm("checkbox")}else if("update"==i){i=f.children("."+y).html();f.children("."+y).html(""),f.append('<input type="text" class="layui-tree-editInput">'),f.children(".layui-tree-editInput").val(i).focus();var d=function(e){var i=(i=e.val().trim())||u.text.defaultNodeName;e.remove(),f.children("."+y).html(i),n.data.text=i,u.operate&&u.operate(n)};f.children(".layui-tree-editInput").blur(function(){d(k(this))}),f.children(".layui-tree-editInput").on("keydown",function(e){13===e.keyCode&&(e.preventDefault(),d(k(this)))})}else{if(u.operate&&u.operate(n),n.status="remove",!c.prev("."+x)[0]&&!c.next("."+x)[0]&&!c.parent("."+q)[0])return c.remove(),void h.elem.append(h.elemNone);c.siblings("."+x).children("."+L)[0]?(u.showCheckbox&&function e(i){var a,n,t,r;i.parents("."+x)[0]&&(a=i.siblings("."+x).children("."+L),i=(n=i.parent("."+q).prev()).find('input[name="layuiTreeCheck"]')[0],t=1,(r=0)==i.checked&&(a.each(function(e,i){i=k(i).find('input[name="layuiTreeCheck"]')[0];0!=i.checked||i.disabled||(t=0),i.disabled||(r=1)}),1==t&&1==r&&(i.checked=!0,h.renderForm("checkbox"),e(n.parent("."+x)))))}(c),u.showLine&&(t=c.siblings("."+x),r=1,l=c.parent("."+q),layui.each(t,function(e,i){k(i).children("."+q)[0]||(r=0)}),1==r?(a[0]||(l.removeClass(F),t.children("."+q).addClass(A),t.children("."+q).children("."+x).removeClass(S)),(c.next()[0]?l.children("."+x).last():c.prev()).children("."+q).children("."+x).last().addClass(S),c.next()[0]||c.parents("."+x)[1]||c.parents("."+x).eq(0).next()[0]||c.prev("."+x).addClass(S)):!c.next()[0]&&c.hasClass(S)&&c.prev().addClass(S))):(t=c.parent("."+q).prev(),u.showLine?(t.find("."+b).removeClass("layui-tree-icon"),t.find("."+b).children(".fa").removeClass(T).addClass("fa-file"),(l=t.parents("."+q).eq(0)).addClass(F),l.children("."+x).each(function(){k(this).children("."+q).children("."+x).last().addClass(S)})):t.find(".layui-tree-iconArrow").addClass(g),c.parents("."+x).eq(0).removeClass(N),c.parent("."+q).remove()),c.remove()}})},i.prototype.drag=function(){var m=this,v=m.config;m.elem.on("dragstart","."+L,function(){var e=k(this).parent("."+x),i=e.parents("."+x)[0]?e.parents("."+x).eq(0):"未找到父节点";v.dragstart&&v.dragstart(e,i)}),m.elem.on("dragend","."+L,function(e){var s,l,i,d,c,o,h=(e=e||event).clientY,u=k(this).parent("."+x),f=u.height(),p=u.offset().top,e=m.elem.find("."+x),y=m.elem.height()+m.elem.offset().top-13,n=u.parents("."+x)[0],t=u.next()[0];n&&(s=u.parent("."+q),l=u.parents("."+x).eq(0),i=l.parent("."+q),d=l.offset().top,c=u.siblings(),o=l.children("."+q).children("."+x).length);function C(l){var a;n||t||m.elem.children("."+x).last().children("."+q).children("."+x).last().addClass(S),n?1==o?(v.showLine?(l.find("."+b).removeClass("layui-tree-icon"),l.find("."+b).children(".fa").removeClass(T).addClass("fa-file"),i.addClass(F),i.children("."+x).children("."+q).each(function(){k(this).children("."+x).last().addClass(S)})):l.find(".layui-tree-iconArrow").addClass(g),l.children("."+q).remove(),l.removeClass(N)):(v.showLine&&(a=1,layui.each(c,function(e,i){k(i).children("."+q)[0]||(a=0)}),1==a?(u.children("."+q)[0]||(s.removeClass(F),c.children("."+q).addClass(A),c.children("."+q).children("."+x).removeClass(S)),s.children("."+x).last().children("."+q).children("."+x).last().addClass(S),t||l.parents("."+x)[0]||l.next()[0]||s.children("."+x).last().addClass(S)):!t&&u.hasClass(S)&&s.children("."+x).last().addClass(S)),v.showCheckbox&&function e(i){if(i){if(!i.parents("."+x)[0])return}else if(!l[0])return;var a=(i?i.siblings():c).children("."+L),n=(i?i.parent("."+q):s).prev(),i=n.find('input[name="layuiTreeCheck"]')[0],t=1,r=0;0==i.checked&&(a.each(function(e,i){i=k(i).find('input[name="layuiTreeCheck"]')[0];0!=i.checked||i.disabled||(t=0),i.disabled||(r=1)}),1==t&&1==r&&(i.checked=!0,m.renderForm("checkbox"),e(n.parent("."+x)||l)))}()):u.removeClass("layui-tree-setHide")}e.each(function(){if(0!=k(this).height()){if(p<h&&h<p+f)return void(v.dragend&&v.dragend("drag error"));if(1==o&&d<h&&h<p+f)return void(v.dragend&&v.dragend("drag error"));var e,i,a,n,t,r=k(this).offset().top;if(r<h&&h<r+15)return k(this).children("."+q)[0]||(v.showLine?(k(this).find("."+b).eq(0).addClass("layui-tree-icon"),k(this).find("."+b).eq(0).children(".fa").addClass(w).removeClass("fa-file")):k(this).find(".layui-tree-iconArrow").removeClass(g),k(this).append('<div class="layui-tree-pack"></div>')),k(this).children("."+q).append(u),C(l),v.showLine&&(e=k(this).children("."+q).children("."+x),u.children("."+q).children("."+x).last().addClass(S),1==e.length?(n=k(this).siblings("."+x),t=1,i=k(this).parent("."+q),layui.each(n,function(e,i){k(i).children("."+q)[0]||(t=0)}),1==t?(n.children("."+q).addClass(A),n.children("."+q).children("."+x).removeClass(S),k(this).children("."+q).addClass(A),i.removeClass(F),i.children("."+x).last().children("."+q).children("."+x).last().addClass(S).removeClass("layui-tree-setHide")):k(this).children("."+q).children("."+x).addClass(S).removeClass("layui-tree-setHide")):(u.prev("."+x).hasClass(S)?(u.prev("."+x).removeClass(S),u.addClass(S)):(u.removeClass("layui-tree-setLineShort layui-tree-setHide"),u.children("."+q)[0]?u.prev("."+x).children("."+q).children("."+x).last().removeClass(S):u.siblings("."+x).find("."+q).each(function(){k(this).children("."+x).last().addClass(S)})),k(this).next()[0]||u.addClass(S))),v.showCheckbox&&k(this).children("."+L).find('input[name="layuiTreeCheck"]')[0].checked&&u.children("."+L).find('input[name="layuiTreeCheck"]+').click(),v.dragend&&v.dragend("drag success",u,k(this)),!1;if(h<r)return k(this).before(u),C(l),v.showLine&&(i=u.children("."+q),r=(a=k(this).parents("."+x).eq(0)).children("."+q).children("."+x).last(),i[0]?(u.removeClass(S),i.children("."+x).last().removeClass(S),n=u.siblings("."+x),t=1,layui.each(n,function(e,i){k(i).children("."+q)[0]||(t=0)}),1==t?a[0]&&(n.children("."+q).addClass(A),n.children("."+q).children("."+x).removeClass(S),r.children("."+q).children("."+x).last().addClass(S).removeClass(A)):u.children("."+q).children("."+x).last().addClass(S),!a.parent("."+q)[0]&&a.next()[0]&&r.removeClass(S)):(a.hasClass(F)||a.addClass(F),a.find("."+q).each(function(){k(this).children("."+x).last().addClass(S)})),a[0]||(u.addClass("layui-tree-setHide"),u.children("."+q).children("."+x).last().removeClass(S))),a[0]&&v.showCheckbox&&a.children("."+L).find('input[name="layuiTreeCheck"]')[0].checked&&u.children("."+L).find('input[name="layuiTreeCheck"]+').click(),v.dragend&&v.dragend("拖拽成功，插入目标节点上方",u,k(this)),!1;if(y<h)return m.elem.children("."+x).last().children("."+q).addClass(A),m.elem.append(u),C(l),u.prev().children("."+q).children("."+x).last().removeClass(S),u.addClass("layui-tree-setHide"),u.children("."+q).children("."+x).last().addClass(S),v.dragend&&v.dragend("拖拽成功，插入最外层节点",u,m.elem),!1}})})},i.prototype.events=function(){var n=this,t=n.config,e=n.elem.find(".layui-tree-checkedFirst");layui.each(e,function(e,i){k(i).children("."+L).find('input[name="layuiTreeCheck"]+').trigger("click")}),n.elem.find(".layui-tree-search").on("keyup",function(){var e=k(this),i=e.val(),e=e.nextAll(),a=[];e.find("."+y).each(function(){var e=k(this).parents("."+L);-1!=k(this).html().indexOf(i)&&(a.push(k(this).parent()),function e(i){i.addClass("layui-tree-searchShow"),i.parent("."+q)[0]&&e(i.parent("."+q).parent("."+x))}(e.parent("."+x)))}),e.find("."+L).each(function(){var e=k(this).parent("."+x);e.hasClass("layui-tree-searchShow")||e.addClass(g)}),0==e.find(".layui-tree-searchShow").length&&n.elem.append(n.elemNone),t.onsearch&&t.onsearch({elem:a})}),n.elem.find(".layui-tree-search").on("keydown",function(){k(this).nextAll().find("."+L).each(function(){k(this).parent("."+x).removeClass("layui-tree-searchShow "+g)}),k(".layui-tree-emptyText")[0]&&k(".layui-tree-emptyText").remove()})},i.prototype.getChecked=function(){var e=this.config,i=[],a=[];return this.elem.find(".layui-form-checked").each(function(){i.push(k(this).prev()[0].value)}),function n(e,t){layui.each(e,function(e,a){layui.each(i,function(e,i){if(a.id==i){i=k.extend({},a);return delete i.children,t.push(i),a.children&&(i.children=[],n(a.children,i.children)),!0}})})}(k.extend({},e.data),a),a},i.prototype.setChecked=function(t){this.config;this.elem.find("."+x).each(function(e,i){var a=k(this).data("id"),n=k(i).children("."+L).find('input[name="layuiTreeCheck"]'),i=n.next();if("number"==typeof t){if(a==t)return n[0].checked||i.click(),!1}else-1!=k.inArray(a,t)&&(n[0].checked||i.click())})},n.that={},n.config={},r.reload=function(e,i){e=n.that[e];return e.reload(i),n.call(e)},r.getChecked=function(e){return n.that[e].getChecked()},r.setChecked=function(e,i){return n.that[e].setChecked(i)},r.render=function(e){e=new i(e);return n.call(e)},e(t,r)});